#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Protection de la branche main - GitFlow
current_branch=$(git symbolic-ref HEAD | sed -e 's,^refs/heads/,,')
protected_branches="main master"

for protected in $protected_branches; do
  if [ "$current_branch" = "$protected" ]; then
    echo "âŒ Vous ne pouvez pas push directement sur la branche $protected"
    echo "ğŸ“‹ Utilisez GitFlow :"
    echo "   1. CrÃ©ez une branche release : git flow release start <version>"
    echo "   2. Ou crÃ©ez un hotfix : git flow hotfix start <version>"
    echo "   3. Ou mergez depuis develop via une Pull Request"
    exit 1
  fi
done

# VÃ©rifier que le build fonctionne avant de push
echo "ğŸ” VÃ©rification du build avant le push..."
npm run build || {
  echo "âŒ Le build a Ã©chouÃ©. Corrigez les erreurs avant de push."
  exit 1
}

echo "âœ… Build rÃ©ussi, push autorisÃ©"
